# 🚀 Pre-Deployment Checklist

## ✅ Everything is Ready!

Your coffee calculator is ready for server deployment. Here's what's been implemented:

### Files Modified/Created
- ✅ `app.py` - Complete backend with authentication
- ✅ `requirements.txt` - Updated dependencies
- ✅ `install.sh` - Auto-generates SECRET_KEY
- ✅ `.gitignore` - Excludes .secret_key
- ✅ `templates/login.html` - Login page
- ✅ `templates/register.html` - Registration page
- ✅ `templates/index.html` - Updated with all features
- ✅ `static/app.js` - All functions implemented
- ✅ Documentation files (TESTING_GUIDE.md, etc.)

### Features Implemented
- ✅ User authentication (login/register/logout)
- ✅ Per-user configurations
- ✅ Tea bag management
- ✅ Custom items per drink
- ✅ Configuration sharing with permissions
- ✅ Secure password hashing
- ✅ Session management
- ✅ All API endpoints with credentials

## 🚀 Deployment Steps

### 1. Commit Your Changes

```powershell
# Check what will be committed
git status

# Add all changes
git add .

# Commit with a descriptive message
git commit -m "Add multi-user authentication, tea bags, custom items, and collaboration features"

# Push to GitHub
git push origin main
```

### 2. On Your Server

```bash
# Navigate to your app directory
cd /path/to/coffee-calculator

# Pull latest changes
git pull origin main

# Run the installation script (will auto-update)
sudo ./install.sh
```

### 3. Select Update Option

When the install script runs, you'll see a menu:
```
========================================
Coffee Calculator - Installation Menu
========================================

Please select an option:

1) Fresh Install
2) Update (git pull + restart)
3) Uninstall (complete removal)

Enter your choice (1-3):
```

**Choose option 2 (Update)**

### 4. What the Update Will Do

The install script will automatically:
- ✅ Pull latest code from git
- ✅ Update Python dependencies (Flask-Login, Flask-Bcrypt)
- ✅ Generate SECRET_KEY (if not exists)
- ✅ Migrate database schema (adds new tables)
- ✅ Update systemd service
- ✅ Restart the service
- ✅ Preserve your existing data

### 5. First Login

After deployment:
1. Navigate to your domain: `https://your-domain.com`
2. You'll be redirected to `/login`
3. Click "Sign up" (goes to `/register`)
4. Create your first account:
   - Name: Your name
   - Email: Your email
   - Password: Strong password (min 6 chars)
5. You'll be logged in and redirected to the calculator

### 6. Existing Data Migration

If you had existing configurations:
- They will be assigned to user_id = 1
- The first user you register will be user_id = 1
- So the first user gets ownership of all existing configs
- Other users won't see them unless you share

## ⚠️ Important Notes

### Before Deployment

1. **Backup your database:**
   ```bash
   cd /path/to/coffee-calculator
   cp data/coffee_calculator.db data/coffee_calculator.db.backup-$(date +%Y%m%d)
   ```

2. **Test locally first (optional but recommended):**
   ```powershell
   pip install -r requirements.txt
   python app.py
   # Visit http://localhost:5000
   ```

### Security

- ✅ SECRET_KEY is auto-generated and stored in `.secret_key`
- ✅ `.secret_key` is in `.gitignore` (won't be committed)
- ✅ Passwords are hashed with bcrypt
- ✅ Sessions are secure
- ✅ All endpoints require authentication

### After Deployment

1. **Check service status:**
   ```bash
   sudo systemctl status coffee-calculator
   ```

2. **View logs if needed:**
   ```bash
   sudo journalctl -u coffee-calculator -f
   ```

3. **Test the site:**
   - Visit your domain
   - Register a user
   - Create a configuration
   - Test all features (see TESTING_GUIDE.md)

## 🔍 Troubleshooting

### If deployment fails:

1. **Check service logs:**
   ```bash
   sudo journalctl -u coffee-calculator -n 50
   ```

2. **Check if service is running:**
   ```bash
   sudo systemctl status coffee-calculator
   ```

3. **Restart service manually:**
   ```bash
   sudo systemctl restart coffee-calculator
   ```

4. **Check Python dependencies:**
   ```bash
   cd /path/to/coffee-calculator
   source venv/bin/activate
   pip list | grep -i flask
   ```

### Common Issues:

**Issue: Can't login after deployment**
- Solution: Clear browser cookies and try again
- Hard refresh: Ctrl+Shift+R

**Issue: "Module not found" error**
- Solution: Make sure dependencies installed: `sudo ./install.sh` (update)

**Issue: Database locked**
- Solution: Stop service, backup DB, restart service
- `sudo systemctl stop coffee-calculator`
- `sudo systemctl start coffee-calculator`

**Issue: SECRET_KEY error**
- Solution: SECRET_KEY should be auto-generated by install.sh
- Check if `.secret_key` file exists in app directory
- If not, run install.sh again

## ✅ Post-Deployment Checklist

After deployment, verify these work:

- [ ] Can access login page
- [ ] Can register new user
- [ ] Can login with credentials
- [ ] Can create configurations
- [ ] Can add tea bags
- [ ] Can add custom items to drinks
- [ ] Can calculate costs correctly
- [ ] Can save configurations
- [ ] Can share configurations
- [ ] Can logout
- [ ] Can login again

## 🎉 You're Ready!

Everything is implemented and ready for deployment. The process will be:

```bash
# 1. Local: Commit and push
git add .
git commit -m "Add multi-user authentication and collaboration"
git push

# 2. Server: Update
cd /path/to/coffee-calculator
sudo ./install.sh
# Choose option 2 (Update)

# 3. Test: Visit your domain and register!
```

## 📞 Quick Reference

**Local Development:**
```powershell
python app.py
```

**Server Update:**
```bash
sudo ./install.sh  # Option 2
```

**Check Status:**
```bash
sudo systemctl status coffee-calculator
```

**View Logs:**
```bash
sudo journalctl -u coffee-calculator -f
```

**Restart Service:**
```bash
sudo systemctl restart coffee-calculator
```

---

## 🚨 IMPORTANT: Commit First!

Before running anything on the server, make sure to:
1. ✅ Commit all changes locally
2. ✅ Push to GitHub
3. ✅ Then run install.sh on server

This ensures the server gets all your new code!

---

**Ready to deploy? Let's go! 🚀**
